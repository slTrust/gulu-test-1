### 实现 toast显示位置

- 默认 top
- 并且校验传递的值必须是 ['top','bottom','middle'] 里的一个 
- 处理api 兼容问题 不用 array.includes 而是使用 array.indexOf 因为后者兼容性更好

```

template 里
----------------------
<template>
    <div class="toast" ref="wrapper" :class="toastClasses">
</template>

----------------------
script里
----------------------
props:{
    ...
    position:{
        type:String,
        default:'top',
        validator(value){
            return ['top','bottom','middle'].indexOf(value)>=0;
        }
    }
},
computed:{
    toastClasses(){
        return {
            [`position-${this.position}`]:true
        }
    }
}

----------------------
css
----------------------
&.position-top{
    top:0;
    transform:translateX(-50%);
}
&.position-bottom{
    bottom:0;
    transform:translateX(-50%);
}
&.position-middle{
    top:50%;
    transform:translate(-50%,-50%);
}
```

### 解决连续toast问题

- 只存在一个 toast

修改 plugin.js

```
import Toast from './toast'

let currentToast;

export default {
    install(Vue,options){
        Vue.prototype.$toast = function(message,toastOptions){
            if(currentToast){
                currentToast.close();
            }
            currentToast = createToast({Vue, message, propsData:toastOptions})


        }
    }
}

/* 动态创建toast 并传递数据 */
function createToast({Vue,message,propsData}){
    let Constructor = Vue.extend(Toast);
    let toast = new Constructor({propsData});
    toast.$slots.default = [message];
    toast.$mount()
    console.log(toast.$el)
    document.body.appendChild(toast.$el)
    return toast;
}
```

- 此时有一个问题

```
if(currentToast){
    currentToast.close();
    // close()的时候 并没有把 currentToast 重置为 null， 所以会多调用一次 close
}
```

> 解决方案 

- 回调
- emit事件 on 接受事件

plugin.js

```
import Toast from './toast'

let currentToast;

export default {
    install(Vue,options){
        Vue.prototype.$toast = function(message,toastOptions){
            if(currentToast){
                currentToast.close();
            }
            currentToast = createToast({
                Vue,
                message,
                propsData:toastOptions,
                onClose:()=>{
                    currentToast = null
                }
            })


        }
    }
}

/* 动态创建toast 并传递数据 */
function createToast({Vue,message,propsData,onClose}){
    let Constructor = Vue.extend(Toast);
    let toast = new Constructor({propsData});
    toast.$slots.default = [message];
    toast.$mount()
    console.log(toast.$el)
    this.on('close',onClose);
    document.body.appendChild(toast.$el)
    return toast;
}
```

toast.vue

```
close(){
    this.$el.remove();
    // 一定要在 $destroy 之前
    this.$emit('close');
    this.$destroy();
},
```




### 实现 toast 动画弹出

```
/* 淡入动画定义 */
@keyframes fade-in {
    0%{opacity: 0; transform: translateY(100%)}
    100%{opacity: 1;transform: translateY(0)}
}
.toast{
    /* 淡入，从下面弹出*/
    animation: fade-in 1s;
    ...
}
```

> 从下面的位置 弹出动画导致了一个 bug

```
x轴现在右边，然后才回到中间，这是为什么呢？
```

